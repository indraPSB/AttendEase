@page "/user"
@using AttendEase.Shared.Components.Users
@using DBUser = AttendEase.DB.Models.User
@attribute [Authorize(Roles = "Admin")]

<PageTitle>User</PageTitle>

<h1>User Management</h1>

<Button Color="ButtonColor.Secondary" Outline="true" @onclick="@(async () => await addInfo.ToggleAsync())"><Icon Name="IconName.PatchQuestion" Size="IconSize.x5" /></Button>
<Collapse @ref="addInfo">
    <Callout Heading="Help">
        <Accordion>
            <AccordionItem Title="How to add users" Name="AccordionItem1">
                <Content>
                    <ol>
                        <li>Click on the "Add User" button.</li>
                        <li>Fill in the user's details.</li>
                        <li>Click on the "Save" button.</li>
                    </ol>
                </Content>
            </AccordionItem>
            <AccordionItem Title="How to edit users" Name="AccordionItem2">
                <Content>
                    <ol>
                        <li>Select a user from the list.</li>
                        <li>Click on the "Edit User" button.</li>
                        <li>Update the user's details.</li>
                        <li>Click on the "Save" button.</li>
                    </ol>
                </Content>
            </AccordionItem>
            <AccordionItem Title="How to delete users" Name="AccordionItem3">
                <Content>
                    <ol>
                        <li>Select one or more users from the list.</li>
                        <li>Click on the "Delete User" button.</li>
                        <li>Confirm the deletion.</li>
                    </ol>
                </Content>
            </AccordionItem>
        </Accordion>
    </Callout>
</Collapse>

<div class="my-2">
    <Button Class="me-1 my-1" Color="ButtonColor.Primary" @onclick="OnAddUser">Add User</Button>
    <Button Class="me-1 my-1" Color="ButtonColor.Primary" @onclick="OnEditUser" Disabled="isEditDisabled">
        Edit User
        <Badge Color="@(isEditDisabled ? BadgeColor.Danger : BadgeColor.Success)">@selectedUsersCount</Badge>
    </Button>
    <Button Class="me-0 my-1" Color="ButtonColor.Primary" @onclick="OnDeleteUsers" Disabled="isDeleteDisabled">
        Delete User
        <Badge Color="@(isDeleteDisabled ? BadgeColor.Danger : BadgeColor.Success)">@selectedUsersCount</Badge>
    </Button>
</div>

<ListUsers SelectedUsersChanged="OnSelectedItemsChanged" />

@code {
    private Collapse addInfo = default!;
    private bool isEditDisabled = true;
    private bool isDeleteDisabled = true;
    private int selectedUsersCount = 0;

    private void OnSelectedItemsChanged(HashSet<DBUser> selectedUsers)
    {
        string countMessage = $"({selectedUsers.Count}{(selectedUsers.Count == 1 ? $" - {selectedUsers.First().Name}" : string.Empty)})";
        isEditDisabled = selectedUsers.Count != 1;
        isDeleteDisabled = selectedUsers.Count < 1;
        selectedUsersCount = selectedUsers.Count;
    }

    private void OnAddUser()
    {

    }

    private void OnEditUser()
    {

    }

    private void OnDeleteUsers()
    {

    }
}
